# Incident-handling-with-Splunk-exploitation-phase1


## Project Report: Investigating the Cyber Attack on Wayne Enterprises

### 1. Overview

Wayne Enterprises recently experienced a cyber attack, where attackers infiltrated their network, compromised their web server, and successfully defaced their website, http://www.imreallynotbatman.com. The website displayed a message, "YOUR SITE HAS BEEN DEFACED," along with the attackers' trademark. I was engaged as a Security Analyst to investigate the incident, identify the root cause, and trace all attacker activities within their network. The investigation focused on the Detection and Analysis phase, utilizing Splunk as the primary SIEM solution to analyze the event logs.

### 2. Investigation

#### 2.1 Exploitation Phase

The exploitation phase involved analyzing the potential exploitation attempt by the attacker against the Wayne Enterprises web server. The goal was to determine if the attacker successfully exploited the vulnerability and to identify the actions they performed.

  Initial Information:
      Two IP addresses were identified during the reconnaissance phase, both of which sent requests to the Wayne Enterprises server.
      One IP address, 40.80.148.42, was observed scanning the server with IP 192.168.250.70 using the web scanner Acunetix.

### 2.2 Log Analysis in Splunk

#### 2.2.1 Counting Requests by Source IP

To understand the number of requests sent by each source IP against the web server, I executed the following search query:



index=botsv1 imreallynotbatman.com sourcetype=stream* | stats count(src_ip) as Requests by src_ip | sort - Requests

![image](https://github.com/user-attachments/assets/36cb67c2-e052-4037-a6ad-63f9c278c3a7)


This query displayed the count of IP addresses sending requests to the server. I then visualized the results to identify patterns.

![image](https://github.com/user-attachments/assets/34beb46b-3e3d-427c-987e-173c608039fd)

#### 2.2.2 Narrowing Down Inbound Traffic

To focus on the specific traffic sent to the web server (IP 192.168.250.70), I refined the search query:


index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70"

![image](https://github.com/user-attachments/assets/2b77ab13-7997-4689-ade6-f02ac9f58c9e)

This search revealed three IP addresses (one local and two remote) originating HTTP traffic towards the web server. The http_method field indicated that most requests were sent through POST requests.

#### 2.2.3 Analyzing POST Requests

To delve deeper into the POST requests, I further refined the search:


index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST

![image](https://github.com/user-attachments/assets/74defb43-e60a-4dc4-842a-fc8123dde8ca)

![image](https://github.com/user-attachments/assets/159ecb77-ba6d-41bf-b6c9-74f336672345)

This search identified two IP addresses responsible for all POST requests to the server. I examined interesting fields like src_ip, form_data, http_user_agent, and uri for further insights.

![image](https://github.com/user-attachments/assets/11f80210-591d-4357-9b3b-1eaa959e537d)


### 2.3 Identifying the Attack Vector

#### 2.3.1 Joomla CMS Exploitation

The web server was found to be using Joomla CMS, as indicated by the presence of the term "Joomla" in various fields like uri, uri_path, and http_referrer. The admin login page for Joomla CMS was located at /joomla/administrator/index.php.

To examine potential brute-force attacks on the admin panel, I used the following search query:


index=botsv1 imreallynotbatman.com sourcetype=stream:http dest_ip="192.168.250.70" uri="/joomla/administrator/index.php"

![image](https://github.com/user-attachments/assets/1e4e4583-851b-464c-89ec-9e2f937d3322)

![image](https://github.com/user-attachments/assets/7a423848-23ba-4fda-9505-f653671828b2)

The form_data field within these logs contained requests sent through the login page, which suggested that the attacker attempted multiple credentials.

![image](https://github.com/user-attachments/assets/8b8755fd-0905-40d5-9e97-06bb69b0c218)

### 2.3.2 Extracting Credentials Using Regex

To extract the username and password fields from the form_data, I employed Regex:


Search Query: index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php" | table _time uri src_ip dest_ip form_data

![image](https://github.com/user-attachments/assets/857b24f3-bd0d-4603-892f-61a03860a0c7)


This search extracted the passwords used against the admin username on the admin panel of the web server.


Search Query: index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST uri="/joomla/administrator/index.php" form_data=*username*passwd* | table _time uri src_ip dest_ip form_data

![image](https://github.com/user-attachments/assets/ea8b7349-e382-49bd-a5bb-8ac0cb2994a4)


![image](https://github.com/user-attachments/assets/1596eb44-b6da-4854-95a1-43672a3137f0)

### 2.3.3 Analyzing Attacker Behavior

To identify the tools used in the attack, I added the http_user_agent field to the search query:


index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "passwd=(?<creds>\w+)" | table _time src_ip uri http_user_agent creds

![image](https://github.com/user-attachments/assets/25327267-a7d6-4d74-b922-9d05e1d06163)

 I found two values against the field http_user_agent as shown below:
 
 ![image](https://github.com/user-attachments/assets/2036558c-4224-47a5-a9bb-fe5d1b2e014c)

The results indicated that the attacker, using IP 23.22.63.114, conducted a brute-force attack with a Python script, while another request came from a Mozilla browser using IP 40.80.148.42.

I created a table to display key fields and values by appending -> | table _time src_ip uri http_user_agent creds in the search query as shown below.

Search Query: index=botsv1 sourcetype=stream:http dest_ip="192.168.250.70" http_method=POST form_data=*username*passwd* | rex field=form_data "passwd=(?<creds>\w+)" |table _time src_ip uri http_user_agent creds

![image](https://github.com/user-attachments/assets/a20289ac-3acf-4710-9767-83fe75a20b5a)

### 3. Findings

  URI with Multiple Brute Force Attempts: /joomla/administrator/index.php
  Username Targeted in Brute Force Attack: admin
  Correct Password for Admin Access: Identified using the extracted passwd field.
  Unique Passwords Attempted: Multiple attempts were made, indicating an automated tool.
  IP Address Likely Attempting Brute Force Attack: 23.22.63.114
  IP Address Used to Log in to the Admin Panel: 40.80.148.42

### 4. Conclusion

The investigation revealed that the attackers exploited a vulnerability in the Joomla CMS, allowing them to execute a brute-force attack on the admin panel. They utilized automated tools, evidenced by the high number of password attempts in a short period. The attackers eventually gained access to the admin panel and defaced the Wayne Enterprises website. The analysis highlights the importance of strong passwords, regular monitoring, and timely patching of vulnerabilities to prevent similar incidents in the future.

